<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Practice Papers</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.quilljs.com/1.3.6/quill.snow.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin/manage_qpractice/practice_paper.css') }}">
</head>
<body>
    <div class="container-fluid">
        <h2 class="main-title">Practice Paper Management</h2>
        <div id="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category|replace('admin_', '') }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>
        <div class="card-section">
            <h3><i class="fas fa-plus-circle text-success"></i> Add Questions</h3>
            <ul class="nav nav-tabs" id="addQuestionTabs" role="tablist">
                <li class="nav-item" role="presentation"><button class="nav-link active" id="csv-tab" data-bs-toggle="tab" data-bs-target="#csv-upload-pane" type="button" role="tab">Upload CSV</button></li>
                <li class="nav-item" role="presentation"><button class="nav-link" id="manual-tab" data-bs-toggle="tab" data-bs-target="#manual-entry-pane" type="button" role="tab">Manual Entry</button></li>
            </ul>
            <div class="tab-content" id="addQuestionTabsContent">
                <div class="tab-pane fade show active" id="csv-upload-pane" role="tabpanel">
                    <form id="uploadCsvForm" class="p-3">
                        <div class="mb-3">
                            <label for="csvPaperCode" class="form-label">Paper Code</label>
                            <select class="form-select" id="csvPaperCode" required>
                                <option value="">Select a Paper Code...</option>
                            </select>
                        </div>
                        <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File</label><input type="file" class="form-control" id="csvFile" accept=".csv" required></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-upload"></i> Upload</button>
                    </form>
                    <div id="csvUploadMessage" class="alert m-3" style="display:none;"></div>
                </div>
                <div class="tab-pane fade" id="manual-entry-pane" role="tabpanel">
                    <div id="manualContext" class="p-3">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="manualPaperCode" class="form-label">Paper Code</label>
                                <select class="form-select" id="manualPaperCode" required>
                                    <option value="">Select a Paper Code...</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3"><label for="manualSubject" class="form-label">Subject</label><input type="text" class="form-control" id="manualSubject" required></div>
                            <div class="col-md-4 mb-3"><label for="manualTopic" class="form-label">Topic (Optional)</label><input type="text" class="form-control" id="manualTopic"></div>
                        </div>
                        <button id="setManualContextBtn" class="btn btn-success">Set Context & Start Adding</button>
                    </div>
                    <div id="manualQuestionFormContainer" class="p-3" style="display:none;">
                        <h4 id="manualContextDisplay"></h4>
                        <form id="manualQuestionForm"></form>
                        <div id="manualAddMessage" class="alert mt-3" style="display:none;"></div>
                        <button id="resetManualContextBtn" class="btn btn-secondary mt-3"><i class="fas fa-sync-alt"></i> Reset Context</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-section">
            <h3><i class="fas fa-search text-info"></i> Search & Edit Questions</h3>
            <div id="searchSection" class="p-3">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="searchPaperCode" class="form-label">Paper Code</label>
                        <select id="searchPaperCode" class="form-select" required>
                            <option value="">Select Paper Code...</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="searchSubject" class="form-label">Subject</label>
                        <select id="searchSubject" class="form-select" required disabled>
                            <option value="">Select Subject...</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="searchTopic" class="form-label">Topic (Optional)</label>
                        <select id="searchTopic" class="form-select" disabled>
                            <option value="">All Topics</option>
                        </select>
                    </div>
                </div>
                <button id="searchBtn" class="btn btn-primary"><i class="fas fa-search"></i> Search</button>
            </div>
            <div id="resultsSection" class="p-3" style="display:none;">
                <h4 id="resultsCount" class="mb-3"></h4>
                <div id="questionDisplayArea"></div>
                <div id="questionNavigation" class="d-flex justify-content-between mt-3">
                    <button class="btn btn-outline-secondary" id="prevQuestionBtn"><i class="fas fa-arrow-left"></i> Previous</button>
                    <button class="btn btn-outline-secondary" id="nextQuestionBtn">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editQuestionModal" tabindex="-1"><div class="modal-dialog modal-xl"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Edit Question</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body"><form id="editQuestionForm"></form></div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="saveQuestionChangesBtn">Save Changes</button>
        </div>
    </div></div></div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="{{ url_for('static', filename='js/admin/manage_qpractice/practice_paper.js') }}"></script>
</body>
</html>
