<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Tests</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin/manage_mock_test/test_details_insert.css') }}">
    <style>
    </style>
</head>
<body>
    <div class="container-fluid">
        <h2 class="text-center mb-4">Admin Panel: Manage Tests</h2>
        <div class="mb-4">
            <label for="testIdSelect" class="form-label"><strong>Select Test ID to Manage:</strong></label>
            <select id="testIdSelect" class="form-select"><option value="">-- Select a Test --</option></select>
        </div>
        <div id="managementArea" style="display: none;">
            <div id="addTestDescriptionContainer" class="form-section">
                <h3>Add New Test Description</h3>
                <form id="addTestDescriptionForm">
                    <input type="hidden" id="addTestDescriptionTestId">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="addTestKey" class="form-label">Test Key</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="addTestKey" required readonly>
                                <button class="btn btn-outline-secondary" type="button" id="generateTestKeyBtn">Generate Key</button>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3"><label for="addSubjectTitle" class="form-label">Subject Title</label><input type="text" class="form-control" id="addSubjectTitle" required></div>
                        <div class="col-md-6 mb-3"><label for="addSubjectSubtitle" class="form-label">Subject Subtitle</label><input type="text" class="form-control" id="addSubjectSubtitle" required></div>
                        <div class="col-md-6 mb-3"><label for="addTotalQuestions" class="form-label">Total Questions</label><input type="number" class="form-control" id="addTotalQuestions" required></div>
                        <div class="col-md-6 mb-3"><label for="addTotalMarks" class="form-label">Total Marks</label><input type="number" step="0.01" class="form-control" id="addTotalMarks" required></div>
                        <div class="col-md-6 mb-3"><label for="addTotalDurationMinutes" class="form-label">Duration (Minutes)</label><input type="number" class="form-control" id="addTotalDurationMinutes" required></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Description</button>
                </form>
                <div id="addTestDescriptionMessage" class="alert mt-3" style="display:none;"></div>
            </div>
            <hr class="my-4">
            <h3>Existing Test Descriptions</h3>
            <div id="main-message-area"></div>
            <table id="testDescriptionsTable" class="table table-striped table-bordered" style="width:100%">
                <thead><tr><th>ID</th><th>Test Key</th><th>Subject</th><th>Questions</th><th>Marks</th><th>Duration</th><th>Actions</th></tr></thead>
                <tbody></tbody>
            </table>
            <div id="questionManagementContainer" class="form-section" style="display: none;">
                <h4 id="questionManagementHeader">Manage Questions</h4>
                <div id="sectionEntryContainer">
                    <div class="row">
                        <div class="col-md-4 mb-3"><label for="sectionIdInput" class="form-label">Section ID</label><input type="text" class="form-control" id="sectionIdInput" placeholder="Enter a unique Section ID"></div>
                        <div class="col-md-4 mb-3"><label for="sectionNameInput" class="form-label">Section Name</label><input type="text" class="form-control" id="sectionNameInput" placeholder="Enter Section Name"></div>
                        <div class="col-md-4 d-flex align-items-end mb-3"><button class="btn btn-primary" id="loadQuestionsForSectionBtn">Load Questions</button></div>
                    </div>
                </div>
                <div id="questionControls" style="display: none;">
                    <div id="questionActionMessage" class="alert" style="display:none;"></div>
                     <div class="d-flex justify-content-between align-items-center mb-3">
                        <div><span class="badge bg-info text-dark fs-6" id="questionCountBadge">Questions: 0 / 0</span></div>
                        <div>
                            <button class="btn btn-secondary me-2" id="changeSectionBtn">Change Section</button>
                            <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#addQuestionModal">Add New Question</button>
                            <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#uploadQuestionsCsvModal">Upload Questions CSV</button>
                        </div>
                    </div>
                    <div id="questionsDisplayArea"></div>
                    <div id="questionNavigation" class="navigation-buttons" style="display: none;"><button class="btn btn-secondary" id="prevQuestionBtn">Previous</button><button class="btn btn-primary" id="nextQuestionBtn">Next</button></div>
                    <div id="noQuestionsMessage" class="alert alert-info" style="display: none;">No questions found for this section.</div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editTestDescriptionModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Edit Test Description</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="editTestDescriptionForm">
                <input type="hidden" id="editTestDescriptionId">
                <div class="mb-3"><label for="editTestKey" class="form-label">Test Key</label><input type="text" class="form-control" id="editTestKey" required readonly></div>
                <div class="mb-3"><label for="editSubjectTitle" class="form-label">Subject Title</label><input type="text" class="form-control" id="editSubjectTitle" required></div>
                <div class="mb-3"><label for="editSubjectSubtitle" class="form-label">Subject Subtitle</label><input type="text" class="form-control" id="editSubjectSubtitle" required></div>
                <div class="mb-3"><label for="editTotalQuestions" class="form-label">Total Questions</label><input type="number" class="form-control" id="editTotalQuestions" required></div>
                <div class="mb-3"><label for="editTotalMarks" class="form-label">Total Marks</label><input type="number" step="0.01" class="form-control" id="editTotalMarks" required></div>
                <div class="mb-3"><label for="editTotalDurationMinutes" class="form-label">Duration (Minutes)</label><input type="number" class="form-control" id="editTotalDurationMinutes" required></div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
            <div id="editTestDescriptionMessage" class="alert mt-3" style="display:none;"></div>
        </div>
    </div></div></div>
    <div class="modal fade" id="deleteTestDescriptionModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Confirm Delete</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">Are you sure you want to delete this test description and all its associated questions? This action cannot be undone.</div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="button" class="btn btn-danger" id="confirmDeleteTestDescriptionBtn">Delete</button></div>
    </div></div></div>
    <div class="modal fade" id="addQuestionModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Add New Question</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="addQuestionForm">
                <div class="row">
                    <div class="col-md-6 mb-3"><label class="form-label">Question Type</label><select class="form-select" id="addQuestionType" required><option value="">Select Type</option><option value="MCQ">MCQ</option><option value="MSQ">MSQ</option><option value="NAT">NAT</option></select></div>
                    <div class="col-md-6 mb-3"><label class="form-label">Question Level</label><select class="form-select" id="addQuestionLevel" required><option value="Medium">Medium</option><option value="Easy">Easy</option><option value="Tough">Tough</option></select></div>
                    <div class="col-md-6 mb-3"><label class="form-label">Correct Marks</label><input type="number" step="0.01" class="form-control" id="addCorrectMarks" required></div>
                    <div class="col-md-6 mb-3"><label class="form-label">Negative Marks</label><input type="text" class="form-control" id="addNegativeMarks" placeholder="e.g., 0.25 or 1/4"></div>
                </div>
                <div class="mb-3"><label class="form-label">Question Text</label><div id="addQuestionTextEditor" class="quill-editor"></div></div>
                <div id="mcqMsqOptions">
                    <div class="mb-3"><label class="form-label">Option A</label><div id="addOptionAEditor" class="quill-editor"></div></div>
                    <div class="mb-3"><label class="form-label">Option B</label><div id="addOptionBEditor" class="quill-editor"></div></div>
                    <div class="mb-3"><label class="form-label">Option C</label><div id="addOptionCEditor" class="quill-editor"></div></div>
                    <div class="mb-3"><label class="form-label">Option D</label><div id="addOptionDEditor" class="quill-editor"></div></div>
                </div>
                <div class="mb-3"><label class="form-label">Correct Answer</label><input type="text" class="form-control" id="addCorrectOption" required placeholder="MCQ: A | MSQ: AB | NAT: 12.3"></div>
                <div class="mb-3"><label class="form-label">Answer Explanation</label><div id="addAnswerTextEditor" class="quill-editor"></div></div>
                <div class="mb-3"><label class="form-label">Explanation Link</label><input type="text" class="form-control" id="addAnswerLink" placeholder="Optional link"></div>
                <button type="submit" class="btn btn-primary">Add Question</button>
            </form>
            <div id="addQuestionMessage" class="alert mt-3" style="display:none;"></div>
        </div>
    </div></div></div>
    <div class="modal fade" id="editQuestionModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">
         <div class="modal-header"><h5 class="modal-title">Edit Question</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
         <div class="modal-body">
            <form id="editQuestionForm">
                <input type="hidden" id="editQuestionId">
                <div class="row">
                    <div class="col-md-6 mb-3"><label class="form-label">Question Type</label><select class="form-select" id="editQuestionType" required><option value="">Select Type</option><option value="MCQ">MCQ</option><option value="MSQ">MSQ</option><option value="NAT">NAT</option></select></div>
                    <div class="col-md-6 mb-3"><label class="form-label">Question Level</label><select class="form-select" id="editQuestionLevel" required><option value="Medium">Medium</option><option value="Easy">Easy</option><option value="Tough">Tough</option></select></div>
                    <div class="col-md-6 mb-3"><label class="form-label">Correct Marks</label><input type="number" step="0.01" class="form-control" id="editCorrectMarks" required></div>
                    <div class="col-md-6 mb-3"><label class="form-label">Negative Marks</label><input type="text" class="form-control" id="editNegativeMarks"></div>
                </div>
                <div class="mb-3"><label class="form-label">Question Text</label><div id="editQuestionTextEditor" class="quill-editor"></div></div>
                <div id="editMcqMsqOptions">
                    <div class="mb-3"><label class="form-label">Option A</label><div id="editOptionAEditor" class="quill-editor"></div></div>
                    <div class="mb-3"><label class="form-label">Option B</label><div id="editOptionBEditor" class="quill-editor"></div></div>
                    <div class="mb-3"><label class="form-label">Option C</label><div id="editOptionCEditor" class="quill-editor"></div></div>
                    <div class="mb-3"><label class="form-label">Option D</label><div id="editOptionDEditor" class="quill-editor"></div></div>
                </div>
                <div class="mb-3"><label class="form-label">Correct Answer</label><input type="text" class="form-control" id="editCorrectOption" required></div>
                <div class="mb-3"><label class="form-label">Answer Explanation</label><div id="editAnswerTextEditor" class="quill-editor"></div></div>
                <div class="mb-3"><label class="form-label">Explanation Link</label><input type="text" class="form-control" id="editAnswerLink" placeholder="Optional link"></div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
            <div id="editQuestionMessage" class="alert mt-3" style="display:none;"></div>
        </div>
    </div></div></div>
    <div class="modal fade" id="deleteQuestionModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Confirm Delete</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">Are you sure you want to delete this question? This action cannot be undone.</div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="button" class="btn btn-danger" id="confirmDeleteQuestionBtn">Delete</button></div>
    </div></div></div>
    <div class="modal fade" id="uploadQuestionsCsvModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"><div class="modal-dialog"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Upload Questions CSV</h5><button type="button" class="btn-close" data-bs-dismiss="modal" id="csv-modal-close-btn"></button></div>
        <div class="modal-body">
            <form id="uploadQuestionsCsvForm">
                <div class="mb-3"><label for="csvFile" class="form-label">Select CSV File:</label><input type="file" class="form-control" id="csvFile" accept=".csv" required></div>
                <button type="submit" class="btn btn-primary" id="uploadCsvSubmitBtn"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span> Upload CSV</button>
            </form>
            <div id="csvUploadMessage" class="alert mt-3" style="display:none;"></div>
            <div id="csvUploadErrors" class="mt-3" style="display:none;"><h6>Errors/Warnings:</h6><ul id="csvErrorList" class="list-group"></ul></div>
        </div>
    </div></div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="{{ url_for('static', filename='js/admin/manage_mock_test/test_details_insert.js') }}"></script>
</body>
</html>