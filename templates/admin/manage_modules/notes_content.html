<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes Content Uploader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin/manage_modules/course_content.css') }}">
    <style>
        .hidden-section { display: none; }
        .notes-list { max-height: 500px; overflow-y: auto; }
        select:disabled { background-color: #e9ecef; }
        .alert-container { position: fixed; top: 1rem; right: 1rem; z-index: 1050; width: 350px; }
        .heading-group, .sub-heading-group { margin-bottom: 1.5rem; padding: 1rem; border-left: 3px solid #0d6efd; background-color: #f8f9fa; }
        .heading-title { font-size: 1.5rem; font-weight: bold; }
        .sub-heading-title { font-size: 1.2rem; font-weight: bold; color: #495057; }
        .flash-message {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.25rem;
        }
        .flash-message.admin_success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .flash-message.admin_error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .flash-message.admin_warning { background-color: #fff3cd; color: #856404; border-color: #ffecb5; }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="alert-container" id="alert-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    <h1 class="mb-4 text-center text-primary">Notes Content Uploader</h1>

    <div id="initial-selection" class="card p-4 mb-4">
        <div class="row g-3">
            <div class="col-md-4">
                <label for="test-id-select" class="form-label">Test ID (Section ID)</label>
                <select id="test-id-select" class="form-select" required>
                    <option selected disabled value="">Choose...</option>
                    {% for item in section_ids %}
                    <option value="{{ item.section_id }}">{{ item.section_id }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="code-select" class="form-label">Code</label>
                <select id="code-select" class="form-select" required disabled>
                    <option selected disabled value="">Select Test ID first</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="type-select" class="form-label">Type</label>
                <select id="type-select" class="form-select" required>
                    <option selected disabled value="">Choose...</option>
                    {% for type_val in type_options %}
                    <option value="{{ type_val }}">{{ type_val }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-12 d-flex justify-content-end">
                <button id="set-initial-btn" class="btn btn-primary">Set & Fetch Notes</button>
            </div>
        </div>
    </div>

    <form id="main-upload-form" method="POST" action="{{ url_for('admin.manage_notes_upload') }}" enctype="multipart/form-data" class="hidden-section card p-4 mb-5">
        <input type="hidden" id="form-test-id" name="test_id">
        <input type="hidden" id="form-code" name="code">
        <input type="hidden" id="form-type" name="type">

        <div id="heading-selection-section" class="hidden-section">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="heading-select" class="form-label">Select Existing Heading</label>
                    <select class="form-select" id="heading-select" name="heading_select"></select>
                </div>
                <div id="heading-input-container" class="col-md-6 hidden-section">
                    <label for="heading-input" class="form-label">Or Add New Heading</label>
                    <input type="text" class="form-control" id="heading-input" name="heading_input">
                </div>
            </div>
        </div>

        <div id="sub-heading-selection-section" class="hidden-section">
             <div class="row mb-3">
                <div class="col-md-6">
                    <label for="sub-heading-select" class="form-label">Select Existing Sub-Heading</label>
                    <select class="form-select" id="sub-heading-select" name="sub_heading_select"></select>
                </div>
                <div id="sub-heading-input-container" class="col-md-6 hidden-section">
                    <label for="sub-heading-input" class="form-label">Or Add New Sub-Heading</label>
                    <input type="text" class="form-control" id="sub-heading-input" name="sub_heading_input">
                </div>
            </div>
        </div>

        <div id="title-entry-section" class="hidden-section">
            <hr class="my-4">
            <h4 class="mb-3">Add New Note Content</h4>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="title" class="form-label">Title</label>
                    <input type="text" class="form-control" id="title" name="title" required>
                </div>
                <div class="col-md-6">
                    <label for="sub_title" class="form-label">Sub-Title (Optional)</label>
                    <input type="text" class="form-control" id="sub_title" name="sub_title">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="file_upload" class="form-label">Upload File (PDF, Image)</label>
                    <input type="file" class="form-control" id="file_upload" name="file_upload">
                </div>
                <div class="col-md-6">
                    <label for="file_url" class="form-label">Or Enter File URL</label>
                    <input type="url" class="form-control" id="file_url" name="file_url" placeholder="https://...">
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-success">Add Note</button>
            </div>
        </div>
    </form>

    <div id="existing-notes-section" class="hidden-section">
        <h3 class="mb-3">Existing Notes</h3>
        <div id="existing-notes-container" class="notes-list">
            <ul class="list-group" id="notes-list-ul"></ul>
            <p id="no-notes-message" class="text-muted d-none">No notes found for this selection.</p>
        </div>
    </div>
</div>
<script src="{{ url_for('static', filename='js/admin/manage_modules/notes_content.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
