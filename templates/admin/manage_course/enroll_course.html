{% extends 'admin/manage_course/base.html' %}

{% block title %}Manage Courses{% endblock %}

{% block content %}
<div class="manage-courses-container">
    <header class="page-header">
        <h2>Manage Courses</h2>
    </header>

    <div id="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    {% if session.admin_role == 'owner' %}
    <section class="add-course">
        <h3>Add New Course</h3>
        <form id="add-course-form" class="course-form" data-add-url="{{ url_for('admin.add_course') }}">
            <input type="text" name="code" placeholder="Course Code" required>
            <input type="text" name="name" placeholder="Course Name" required>
            <textarea name="description" placeholder="Description" required></textarea>
            <button type="submit" class="btn btn-success">Add Course</button>
        </form>
    </section>
    {% endif %}

    <div class="view-courses-controls">
        <button id="toggle-courses-btn" class="btn btn-info">View Existing Courses</button>
    </div>

    <div id="existing-courses-wrapper" style="display: none;">
        <section class="course-table">
            <h3>Existing Courses</h3>
            <div class="table-responsive">
                <table id="courses-table" 
                       data-update-url-template="{{ url_for('admin.update_course', code='CODE_PLACEHOLDER') }}"
                       data-delete-url-template="{{ url_for('admin.delete_course', code='CODE_PLACEHOLDER') }}">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Description</th>
                            {% if session.admin_role == 'owner' %}
                            <th>Actions</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for course in courses %}
                        <tr data-code="{{ course.code }}">
                            <td data-field="code">{{ course.code }}</td>
                            <td data-field="name">{{ course.name }}</td>
                            <td data-field="description">{{ course.description }}</td>
                            {% if session.admin_role == 'owner' %}
                            <td class="action-buttons">
                                <button class="btn btn-update">Update</button>
                                <button class="btn btn-delete">Delete</button>
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</div>
<script>
    const ADMIN_ROLE = "{{ session.admin_role or '' }}";
</script>
{% endblock %}
